# ğŸš€ ç”¨è—¥æé†’ç³»çµ± - éƒ¨ç½²é…ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°
æ­¤æŒ‡å—èªªæ˜å…¶ä»–é–‹ç™¼è€…éƒ¨ç½²æ­¤ç”¨è—¥æé†’ç³»çµ±æ™‚éœ€è¦ä¿®æ”¹çš„é…ç½®å…§å®¹ã€‚

---

## ğŸ”§ å¿…é ˆä¿®æ”¹çš„é…ç½®é …ç›®

### 1ï¸âƒ£ **GCP é …ç›®è¨­å®š**

#### ä¿®æ”¹æ–‡ä»¶ï¼š`GCP éƒ¨ç½².md`
```bash
# å°‡ä»¥ä¸‹é …ç›®IDæ›¿æ›ç‚ºæ‚¨çš„GCPé …ç›®ID
# ç•¶å‰è¨­å®šï¼šsunlit-hook-461906-r1
# éœ€è¦ä¿®æ”¹çš„åœ°æ–¹ï¼š

# Docker Image è·¯å¾‘
docker build -t us-central1-docker.pkg.dev/[æ‚¨çš„é …ç›®ID]/njdg/pill_test:latest .
docker push us-central1-docker.pkg.dev/[æ‚¨çš„é …ç›®ID]/njdg/pill_test:latest

# Cloud Run éƒ¨ç½²
gcloud run deploy linebot0711 --image=us-central1-docker.pkg.dev/[æ‚¨çš„é …ç›®ID]/njdg/pill_test:latest

# Cloud Scheduler URLï¼ˆéœ€è¦åœ¨éƒ¨ç½²å¾Œç²å¾—å¯¦éš›URLï¼‰
--uri="https://[æ‚¨çš„æœå‹™åç¨±]-[æ‚¨çš„é …ç›®ID].us-central1.run.app/api/check-reminders"
```

### 2ï¸âƒ£ **Python ä»£ç¢¼é…ç½®**

#### ä¿®æ”¹æ–‡ä»¶ï¼š`config.py` (ç¬¬41-44è¡Œ)
```python
# è—¥ä¸¸è¾¨è­˜ API è¨­å®š - æ›¿æ›ç‚ºæ‚¨çš„APIæœå‹™URL
PILL_API_URLS = [
    "https://line-bot-[æ‚¨çš„é …ç›®ID].us-central1.run.app",
    "https://line-bot2-[æ‚¨çš„é …ç›®ID].us-central1.run.app", 
    "https://detect-api-self.wenalyzer.xyz/detect"  # ç¬¬ä¸‰æ–¹APIå¯ä¿æŒä¸è®Š
]
```

#### ä¿®æ”¹æ–‡ä»¶ï¼š`app/routes/handlers/pill_handler.py` (ç¬¬38-42è¡Œ)
```python
# æ›¿æ›APIæœå‹™URL
apis = [
    {
        "name": "FastAPI Service",
        "url": "https://fastapi-[æ‚¨çš„é …ç›®ID].us-central1.run.app"
    },
    {
        "name": "FastAPI V11 Service", 
        "url": "https://fastapiv11-[æ‚¨çš„é …ç›®ID].us-central1.run.app/"
    }
]
```

### 3ï¸âƒ£ **ç’°å¢ƒè®Šæ•¸è¨­å®š**

#### å‰µå»ºæ‚¨çš„ `.env` æ–‡ä»¶ï¼ˆåŸºæ–¼ `.env.example`ï¼‰
```bash
# --- LINE Bot API è¨­å®š ---
LINE_CHANNEL_ACCESS_TOKEN=æ‚¨çš„_line_channel_access_token
LINE_CHANNEL_SECRET=æ‚¨çš„_line_channel_secret
YOUR_BOT_ID=@æ‚¨çš„_bot_id

# LINE Login è¨­å®š
LINE_LOGIN_CHANNEL_ID=æ‚¨çš„_line_login_channel_id
LINE_LOGIN_CHANNEL_SECRET=æ‚¨çš„_line_login_channel_secret

# --- LIFF æ‡‰ç”¨ç¨‹å¼è¨­å®š ---
LIFF_CHANNEL_ID=æ‚¨çš„_liff_channel_id
LIFF_ID_CAMERA=æ‚¨çš„_camera_liff_id
LIFF_ID_EDIT=æ‚¨çš„_edit_liff_id
LIFF_ID_PRESCRIPTION_REMINDER=æ‚¨çš„_prescription_reminder_liff_id
LIFF_ID_MANUAL_REMINDER=æ‚¨çš„_manual_reminder_liff_id
LIFF_ID_HEALTH_FORM=æ‚¨çš„_health_form_liff_id

# --- Google Gemini API è¨­å®š ---
GEMINI_API_KEY=æ‚¨çš„_gemini_api_key

# --- MySQL è³‡æ–™åº«è¨­å®š ---
DB_HOST=æ‚¨çš„_è³‡æ–™åº«ä¸»æ©Ÿ
DB_USER=æ‚¨çš„_è³‡æ–™åº«ç”¨æˆ¶å
DB_PASS=æ‚¨çš„_è³‡æ–™åº«å¯†ç¢¼
DB_NAME=æ‚¨çš„_è³‡æ–™åº«åç¨±
DB_PORT=3306

# --- Cloud Scheduler è¨­å®š ---
REMINDER_SECRET_TOKEN=æ‚¨çš„-å®‰å…¨-éš¨æ©Ÿ-token
```

### 4ï¸âƒ£ **GCP æœå‹™å¸³æˆ¶**

#### æ›¿æ›æ–‡ä»¶ï¼š`cji25.json`
- å‰µå»ºæ‚¨è‡ªå·±çš„GCPæœå‹™å¸³æˆ¶
- ä¸‹è¼‰æœå‹™å¸³æˆ¶é‡‘é‘°JSONæ–‡ä»¶
- é‡å‘½åç‚º `cji25.json` æˆ–ä¿®æ”¹ `config.py` ä¸­çš„è·¯å¾‘

---

## ğŸ” éƒ¨ç½²å‰æª¢æŸ¥æ¸…å–®

### âœ… **GCP è¨­å®šæª¢æŸ¥**
- [ ] å·²å‰µå»ºGCPé …ç›®
- [ ] å·²å•Ÿç”¨å¿…è¦çš„APIï¼ˆCloud Run, Artifact Registry, Cloud Schedulerï¼‰
- [ ] å·²å‰µå»ºArtifact Registry repository
- [ ] å·²è¨­å®šDockerèªè­‰

### âœ… **LINE è¨­å®šæª¢æŸ¥**
- [ ] å·²å‰µå»ºLINE Bot Channel
- [ ] å·²å‰µå»ºLINE Login Channel  
- [ ] å·²å‰µå»ºæ‰€æœ‰å¿…è¦çš„LIFFæ‡‰ç”¨ç¨‹å¼
- [ ] å·²è¨­å®šWebhook URL

### âœ… **è³‡æ–™åº«è¨­å®šæª¢æŸ¥**
- [ ] å·²å‰µå»ºMySQLè³‡æ–™åº«
- [ ] å·²åŸ·è¡Œè³‡æ–™åº«åˆå§‹åŒ–è…³æœ¬
- [ ] å·²æ¸¬è©¦è³‡æ–™åº«é€£ç·š

### âœ… **API æœå‹™æª¢æŸ¥**
- [ ] å·²éƒ¨ç½²è—¥ä¸¸è¾¨è­˜APIæœå‹™
- [ ] å·²ç²å¾—Google Gemini APIé‡‘é‘°
- [ ] å·²æ¸¬è©¦æ‰€æœ‰å¤–éƒ¨APIé€£ç·š

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æ­¥é©Ÿ

1. **å…‹éš†å°ˆæ¡ˆä¸¦ä¿®æ”¹é…ç½®**
   ```bash
   git clone [å°ˆæ¡ˆURL]
   cd [å°ˆæ¡ˆç›®éŒ„]/0713
   ```

2. **ä¿®æ”¹é…ç½®æ–‡ä»¶**
   - æŒ‰ç…§ä¸Šè¿°æŒ‡å—ä¿®æ”¹æ‰€æœ‰é…ç½®é …ç›®
   - å‰µå»º `.env` æ–‡ä»¶

3. **åŸ·è¡Œéƒ¨ç½²æŒ‡ä»¤**
   ```bash
   # æŒ‰ç…§ GCP éƒ¨ç½².md ä¸­çš„æ­¥é©ŸåŸ·è¡Œ
   gcloud services enable run.googleapis.com artifactregistry.googleapis.com
   gcloud artifacts repositories create njdg --repository-format=docker --location=us-central1
   gcloud auth configure-docker us-central1-docker.pkg.dev
   
   # å»ºç«‹ä¸¦æ¨é€Docker Image
   docker build -t us-central1-docker.pkg.dev/[æ‚¨çš„é …ç›®ID]/njdg/pill_test:latest .
   docker push us-central1-docker.pkg.dev/[æ‚¨çš„é …ç›®ID]/njdg/pill_test:latest
   
   # éƒ¨ç½²åˆ°Cloud Run
   gcloud run deploy linebot0711 --image=us-central1-docker.pkg.dev/[æ‚¨çš„é …ç›®ID]/njdg/pill_test:latest --region=us-central1 --platform=managed --allow-unauthenticated --env-vars-file=env.yaml --min-instances=1 --memory=1Gi --timeout=300s
   
   # è¨­å®šCloud Scheduler
   gcloud services enable cloudscheduler.googleapis.com
   gcloud app create --region=us-central1
   gcloud scheduler jobs create http reminder-check-job --location=us-central1 --schedule="* * * * *" --uri="https://[æ‚¨çš„æœå‹™URL]/api/check-reminders" --http-method=POST --headers="Content-Type=application/json,Authorization=Bearer [æ‚¨çš„token]" --description="æ¯åˆ†é˜æª¢æŸ¥ä¸¦ç™¼é€ç”¨è—¥æé†’" --time-zone="Asia/Taipei"
   ```

---

## âš ï¸ é‡è¦æ³¨æ„äº‹é …

1. **å®‰å…¨æ€§**ï¼š
   - è«‹ä½¿ç”¨å¼·éš¨æ©Ÿå­—ç¬¦ä¸²ä½œç‚º `REMINDER_SECRET_TOKEN`
   - ä¸è¦å°‡ `.env` æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»çµ±
   - å®šæœŸè¼ªæ›APIé‡‘é‘°å’Œtoken

2. **æˆæœ¬æ§åˆ¶**ï¼š
   - Cloud Scheduler æ¯åˆ†é˜åŸ·è¡Œæœƒç”¢ç”Ÿè²»ç”¨
   - å¯æ ¹æ“šéœ€æ±‚èª¿æ•´åŸ·è¡Œé »ç‡
   - ç›£æ§Cloud Runçš„ä½¿ç”¨é‡

3. **æ¸¬è©¦**ï¼š
   - éƒ¨ç½²å¾Œè«‹æ¸¬è©¦æ‰€æœ‰åŠŸèƒ½
   - ç¢ºèªæé†’ç³»çµ±æ­£å¸¸é‹ä½œ
   - æª¢æŸ¥è³‡æ–™åº«é€£ç·šç‹€æ…‹

---

## ğŸ†˜ æ•…éšœæ’é™¤

å¦‚æœé‡åˆ°å•é¡Œï¼Œè«‹æª¢æŸ¥ï¼š
1. æ‰€æœ‰ç’°å¢ƒè®Šæ•¸æ˜¯å¦æ­£ç¢ºè¨­å®š
2. GCPé …ç›®IDæ˜¯å¦ä¸€è‡´
3. æœå‹™å¸³æˆ¶æ¬Šé™æ˜¯å¦è¶³å¤ 
4. ç¶²è·¯é€£ç·šæ˜¯å¦æ­£å¸¸
5. æŸ¥çœ‹Cloud Runå’ŒCloud Schedulerçš„æ—¥èªŒ

---

**æœ€å¾Œæ›´æ–°**ï¼š2025å¹´1æœˆ
**ç‰ˆæœ¬**ï¼š1.0.0