# 並行處理測試檢查清單

## 📋 測試準備 (2025-01-13)

### 🎯 測試目標
驗證並行處理優化的效果和穩定性，確保功能正常且性能提升。

### 📊 測試指標
- **處理時間**: 對比並行vs序列的執行時間
- **成功率**: 確保並行處理不影響成功率
- **準確性**: 驗證藥物識別和頻率解析準確性
- **穩定性**: 測試錯誤處理和回退機制

## ✅ 測試案例

### 基礎功能測試
- [ ] **單圖處理**: 1張圖片的並行處理效果
- [ ] **多圖處理**: 2-5張圖片的並行處理效果
- [ ] **空圖片**: 處理空列表的錯誤處理
- [ ] **大圖片**: 處理大尺寸圖片的性能

### 並行機制測試
- [ ] **正常並行**: 資料庫和OCR都成功的情況
- [ ] **資料庫失敗**: 資料庫連接失敗時的回退
- [ ] **OCR失敗**: API調用失敗時的回退
- [ ] **完全失敗**: 兩個任務都失敗時的處理

### 性能對比測試
- [ ] **時間對比**: 記錄並行vs序列的處理時間
- [ ] **資源使用**: 監控CPU和記憶體使用情況
- [ ] **API調用**: 確認仍然只有2次API調用
- [ ] **Token使用**: 驗證Token使用量沒有增加

### 邊界條件測試
- [ ] **網路延遲**: 模擬高延遲環境
- [ ] **高負載**: 多用戶同時使用的情況
- [ ] **記憶體限制**: 在記憶體受限環境下測試
- [ ] **超時處理**: 長時間運行的任務處理

## 📈 預期結果

### 性能提升目標
- **單圖**: 15秒 → 13秒 (13%提升)
- **多圖**: 20秒 → 16秒 (20%提升)
- **成功率**: 維持95%以上
- **準確性**: 無明顯下降

### 監控指標
```
期望的日誌輸出:
[Smart Filter] 處理模式: parallel
[Smart Filter] 並行處理時間: X.XXXXs
[Smart Filter] 總執行時間: X.XXXXs
```

## 🚨 測試失敗標準

### 立即回退條件
- 處理時間增加超過10%
- 成功率下降超過5%
- 出現新的嚴重錯誤
- 系統資源使用異常

### 回退步驟
```bash
# 緊急回退指令
cp 0711/app/services/ai_processor_stable_backup.py 0711/app/services/ai_processor.py
```

## 📝 測試記錄模板

### 測試環境
- **日期時間**: 
- **測試環境**: 
- **圖片數量**: 
- **圖片大小**: 

### 測試結果
- **處理模式**: parallel/sequential_fallback
- **處理時間**: 
- **成功率**: 
- **錯誤訊息**: 
- **資源使用**: 

### 對比數據
- **並行版本時間**: 
- **穩定版本時間**: 
- **時間節省**: 
- **性能提升**: 

## 🎯 測試計劃

### Phase 1: 基礎驗證 (立即執行)
1. 單圖處理測試
2. 多圖處理測試
3. 錯誤處理測試

### Phase 2: 性能測試 (1-2小時)
1. 時間對比測試
2. 負載測試
3. 穩定性測試

### Phase 3: 生產驗證 (如果Phase 1-2通過)
1. 小範圍用戶測試
2. 監控系統指標
3. 用戶回饋收集

---
**重要提醒**: 任何測試失敗都要立即記錄並考慮回退到穩定版本。